<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>Protect your vps!</title><link rel="canonical" href="https://blog.nvimer.org/2023/02/09/protect-vps/"><meta name="description" content="PrefaceEveryone connected to the internet is a target for hackers. The Most Incredible Cyber Attack Statistics of 2021 Find out the number of cyber at"><meta name="keywords" content="jinzhongjia,jin"><meta name="author" content="Jin Zhongjia"><meta property="og:site_name" content="Jin&#39;s blog"><meta property="og:type" content="article"><meta property="og:title" content="Protect your vps!"><meta property="og:description" content="PrefaceEveryone connected to the internet is a target for hackers. The Most Incredible Cyber Attack Statistics of 2021 Find out the number of cyber at"><meta property="og:url" content="https://blog.nvimer.org/2023/02/09/protect-vps/"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="Protect your vps!"><meta name="twitter:description" content="PrefaceEveryone connected to the internet is a target for hackers. The Most Incredible Cyber Attack Statistics of 2021 Find out the number of cyber at"><meta name="twitter:url" content="https://blog.nvimer.org/2023/02/09/protect-vps/"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="preload" href="/fonts/dm-serif-display-v4-latin-regular.woff2" as="font" type="font/woff2" crossorigin><link rel="preload" href="/fonts/inter-v2-latin-regular.woff2" as="font" type="font/woff2" crossorigin><link rel="stylesheet" href="/css/normalize.css"><link rel="stylesheet" href="/css/skeleton.css"><link rel="stylesheet" href="/css/custom.css"><link rel="stylesheet" href="/css/prism-dark.css"><link rel="stylesheet" href="/css/prism-line-numbers.css"><link rel="stylesheet" href="/public/css/user.css"><link rel="stylesheet" href="/css/katex.min.css"><link rel="icon" type="image/png" href="/public/images/favicon.ico"><style>a:not(.icon){text-decoration-color:#0fa0ce;background-image:linear-gradient(to bottom,rgba(0,0,0,0) 50%,#0fa0ce 50%)}blockquote{border-left:8px solid #0fa0ce}.nanobar .bar{background:#0fa0ce}.button.button-primary:focus,.button.button-primary:hover,button.button-primary:focus,button.button-primary:hover,input[type=button].button-primary:focus,input[type=button].button-primary:hover,input[type=reset].button-primary:focus,input[type=reset].button-primary:hover,input[type=submit].button-primary:focus,input[type=submit].button-primary:hover{background-color:#0fa0ce;border-color:#0fa0ce}input[type=email]:focus,input[type=number]:focus,input[type=password]:focus,input[type=search]:focus,input[type=tel]:focus,input[type=text]:focus,input[type=url]:focus,select:focus,textarea:focus{border:1px solid #0fa0ce}</style><script src="/js/pic.min.js" defer></script><script src="/js/search.min.js" defer></script><script src="/js/katex.min.js" defer></script><script src="/js/auto-render.min.js" defer></script><script>document.addEventListener("DOMContentLoaded",(function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"\\[",right:"\\]",display:!0}],throwOnError:!1})}))</script><meta name="generator" content="Hexo 6.3.0"></head><body><div class="container"><div class="row"><div><div class="row"><div class="two columns" style="max-width:50px"><h1 class="mt-2 mode"><div onclick="setDarkMode(!0)" id="darkBtn">üåë</div><div onclick="setDarkMode(!1)" id="lightBtn" class="hidden">‚òÄÔ∏è</div><script>function setDarkMode(e){var t=document.getElementById("darkBtn"),l=document.getElementById("lightBtn");e?(l.style.display="block",t.style.display="none",localStorage.setItem("preferredTheme","dark")):(l.style.display="none",t.style.display="block",localStorage.removeItem("preferredTheme")),document.body.classList.toggle("darkmode")}"dark"==localStorage.getItem("preferredTheme")&&setDarkMode(!0)</script></h1></div><div class="six columns ml-1"><h1 class="mt-2">Hi Folks.</h1></div><div class="twelve columns"><div class="row"><div class="nine columns left"><a href="/">Home</a> <a href="/archives" class="ml">Archives</a> <a href="/About" class="ml">About</a> <a href="mailto:jinzhongjia@qq.com" target="_blank" class="ml">Email</a></div></div><hr style="margin-bottom:2.6rem"></div></div><div class="trans"><h2>Protect your vps!</h2><h2 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h2><p>Everyone connected to the internet is a target for hackers.</p><p>The Most Incredible Cyber Attack Statistics of 2021 Find out the number of cyber attacks happening every day around the world.</p><ul><li><p>Worldwide, 30,000 websites are hacked every day.</p></li><li><p>64% of companies worldwide have experienced at least one form of cyber attack.</p></li><li><p>20 million records compromised in March 2021.</p></li><li><p>In 2020, ransomware cases increased by 150%.</p></li><li><p>Email accounts for approximately 94% of all malware.</p></li><li><p>Every 39 seconds, a new attack occurs somewhere on the network.</p></li><li><p>On average, approximately 24,000 malicious mobile applications are blocked on the Internet every day.</p></li></ul><p>Therefore, network security protection is very important!</p><h2 id="Start-protection-work"><a href="#Start-protection-work" class="headerlink" title="Start protection work"></a>Start protection work</h2><blockquote><p>This article takes Debian as an example, the operation of Ubuntu is similar, and the CentOS system will be different, please search for relevant content by yourself. (It is strongly recommended that you use Ubuntu or Debian system)</p></blockquote><h3 id="SSH-protection"><a href="#SSH-protection" class="headerlink" title="SSH protection"></a>SSH protection</h3><p>In fact, many vps are regarded as broilers because the ssh login password has been cracked, especially the root user has been cracked by violence and installed a backdoor program, and the whole chick has become a compelling puppet chicken (broiler)</p><h4 id="Change-ssh-port"><a href="#Change-ssh-port" class="headerlink" title="Change ssh port"></a>Change ssh port</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">vim</span> /etc/ssh/sshd_config<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Then change the <code>port</code> field, which is to change the ssh port. After the changes are saved, use <code>systemctl sshd restart</code> to restart the ssh service</p><h4 id="Change-ssh-password"><a href="#Change-ssh-password" class="headerlink" title="Change ssh password"></a>Change ssh password</h4><p>Very simple, use the <code>psswd</code> command to change the password.<br>Note: <em>Password is not visible when entered</em>!</p><h4 id="Create-a-new-normal-user"><a href="#Create-a-new-normal-user" class="headerlink" title="Create a new normal user"></a>Create a new normal user</h4><ol><li>Create a new user</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">adduseradmin<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>You can create a new user, and you will be asked to enter the password twice and some information. The information other than the password can be entered all the way to end. If necessary, you can understand the information and set it by yourself.</p><ol start="2"><li>Install sudo</li></ol><p>After creating a new ordinary user, we need to use sudo to allow ordinary users to obtain root privileges</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">apt</span> <span class="token function">install</span> <span class="token function">sudo</span> <span class="token comment">#Debain does not have it by default, Ubuntu itself should have been installed</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="3"><li>Make sudo settings</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">visudo<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Use <code>ctrl+K O</code> to save, press Enter, then <code>ctrl + K Q</code>, you can save and exit!</p><p>Look for the <code>User Privilege Specification</code> field, and add a new line:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">admin <span class="token assign-left variable">ALL</span><span class="token operator">=</span><span class="token punctuation">(</span>ALL<span class="token punctuation">)</span> NOPASSWD: ALL
<span class="token comment">#admin is the username</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>Setting ‚ÄúNOPASSWD‚Äù allows the admin user to use root privileges without entering an additional password. If you are required to enter a password when using root privileges, you can change it to <code>sadmin ALL=(ALL:ALL) ALL</code></p><ol start="4"><li>Disable root login</li></ol><p>Forbid root to log in to vps through ssh, which can greatly avoid the situation that vps becomes a bot. At the same time, it can also be used by switching to the root user through the <code>su</code> command after logging in through other users ssh</p><p>Edit the ssh configuration file:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">vim</span> /etc/ssh/sshd_config
<span class="token comment">#If you log in as a normal user, you need to use sudo</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>Change the <code>PermitRootLogin</code> field to no</p><p>Then save and exit, restart the ssh service <code>sudo systemctl sshd restart</code></p><p>After that, when using root for ssh login, the vps will directly deny access, and has been asking for a password</p><h3 id="Ufw-firewall"><a href="#Ufw-firewall" class="headerlink" title="Ufw firewall"></a>Ufw firewall</h3><h4 id="Install"><a href="#Install" class="headerlink" title="Install"></a>Install</h4><p>Install ufw firewall (based on iptable), Debian needs to be installed manually, Ubuntu already comes with it by default</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">apt</span> <span class="token function">install</span> ufw<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="Basic-configuration"><a href="#Basic-configuration" class="headerlink" title="Basic configuration"></a>Basic configuration</h4><p>Set basic defaults</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ufw default deny incoming
ufw default allow outgoing<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>Allow ssh connections</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ufw allow <span class="token function">ssh</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Allow http and https connections</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ufw allow http
ufw allow https<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="Start-ufw"><a href="#Start-ufw" class="headerlink" title="Start ufw"></a>Start ufw</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ufw <span class="token builtin class-name">enable</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="Manage-firewall-rules"><a href="#Manage-firewall-rules" class="headerlink" title="Manage firewall rules"></a>Manage firewall rules</h4><p>View firewall status</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ufw status<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ufw status numbered<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>delete rule</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ufw delete <span class="token number">5</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>add rules</p><p>Allow port 81, ufw rules are more complicated</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ufw allow <span class="token number">81</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Overload configuration</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ufw reload<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="Ban-ping"><a href="#Ban-ping" class="headerlink" title="Ban ping"></a>Ban ping</h4><p>Directly edit the rule of ufw, you can also edit the rules of iptable</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">vim</span> /etc/ufw/before.rules<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Find the <code># ok icmp codes for INPUT</code> area, and change <code>ACCEPT</code> in <code>echo-request -j ACCEPT</code> in the last line to <code>DROP</code></p><h4 id="No-brute-force-cracking"><a href="#No-brute-force-cracking" class="headerlink" title="No brute force cracking"></a>No brute force cracking</h4><p>Use file2ban to ban bruteforcing</p><p>Install file2ban</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">apt</span> <span class="token function">install</span> fail2ban<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>copy configuration file</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> /etc/fail2ban <span class="token comment"># Enter the fail2ban directory</span>
<span class="token function">cp</span> fail2ban.conf fail2ban.local <span class="token comment"># backup</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>edit configuration file</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">vim</span> fail2ban.conf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>sshd<span class="token punctuation">]</span>
<span class="token builtin class-name">enable</span> <span class="token operator">=</span> <span class="token boolean">true</span>
port <span class="token operator">=</span> <span class="token number">22</span> <span class="token comment">#port</span>
<span class="token assign-left variable">filter</span><span class="token operator">=</span>sshd
logpath <span class="token operator">=</span> /var/log/auth.log
maxretry <span class="token operator">=</span> <span class="token number">3</span>
bantime <span class="token operator">=</span> <span class="token parameter variable">-1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>service management</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">service</span> fail2ban restart <span class="token comment">#restart</span>
fail2ban-client status <span class="token comment">#View status</span>
fail2ban-client status sshd <span class="token comment">#View detailed status of sshd</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>Unban ip</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">fail2ban-client <span class="token builtin class-name">set</span> sshd unbanip <span class="token number">192.0</span>.0.1 <span class="token comment">#Unban the specified IP</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><a class="classtest-link" href="/tags/linux/" rel="tag">linux</a>, <a class="classtest-link" href="/tags/vps/" rel="tag">vps</a> ‚Äî Feb 9, 2023</p></div><div class="row mt-2"><h3>Search</h3><div><input id="search-text" title="search" class="search-text" type="text" placeholder="search......"></div><div style="margin-top:1.5rem"><ul id="result"></ul></div></div><div class="row mt-2"><div class="eight columns"><p id="madewith">Made with ‚ù§ and <a class="footer-link icon" href="https://hexo.io" target="_blank" style="text-decoration:none" rel="noreferrer" aria-label="Hexo.io"><svg class="hexo svg-hov" width="14" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>Hexo.js</title><path d="M12 .007L1.57 6.056V18.05L12 23.995l10.43-6.049V5.952L12 .007zm4.798 17.105l-.939.521-.939-.521V12.94H9.08v4.172l-.94.521-.938-.521V6.89l.939-.521.939.521v4.172h5.84V6.89l.94-.521.938.521v10.222z"/></svg> </a>at <a href="https://en.wikipedia.org/wiki/China" target="_blank" rel="noreferrer">China</a>.</p></div><div class="four columns mb-3 posisi"><a class="ml-0 footer-link icon" href="https://github.com/jinzhongjia" target="_blank" style="text-decoration:none" rel="noreferrer" aria-label="GitHub"><svg class="github svg-hov" width="18" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a></div></div></div></div></div><script src="/js/nanobar.min.js"></script><script>var options={classname:"nanobar",id:"myNanobar"},nanobar=new Nanobar(options);nanobar.go(30),nanobar.go(76),nanobar.go(100)</script></body></html>