<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>Implement KMP algorithm in zig</title><link rel="canonical" href="https://blog.nvimer.org/2023/03/11/implement-kmp-algorithm-of-zig/"><meta name="description" content="PrefaceKMP called Knuth‚ÄìMorris‚ÄìPratt string-searching algorithm, which is the first linear-time algorithm for string matching. According to wikipedia:"><meta name="keywords" content="jinzhongjia,jin"><meta name="author" content="Jin Zhongjia"><meta property="og:site_name" content="Jin&#39;s blog"><meta property="og:type" content="article"><meta property="og:title" content="Implement KMP algorithm in zig"><meta property="og:description" content="PrefaceKMP called Knuth‚ÄìMorris‚ÄìPratt string-searching algorithm, which is the first linear-time algorithm for string matching. According to wikipedia:"><meta property="og:url" content="https://blog.nvimer.org/2023/03/11/implement-kmp-algorithm-of-zig/"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="Implement KMP algorithm in zig"><meta name="twitter:description" content="PrefaceKMP called Knuth‚ÄìMorris‚ÄìPratt string-searching algorithm, which is the first linear-time algorithm for string matching. According to wikipedia:"><meta name="twitter:url" content="https://blog.nvimer.org/2023/03/11/implement-kmp-algorithm-of-zig/"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="preload" href="/fonts/dm-serif-display-v4-latin-regular.woff2" as="font" type="font/woff2" crossorigin><link rel="preload" href="/fonts/inter-v2-latin-regular.woff2" as="font" type="font/woff2" crossorigin><link rel="stylesheet" href="/css/normalize.css"><link rel="stylesheet" href="/css/skeleton.css"><link rel="stylesheet" href="/css/custom.css"><link rel="stylesheet" href="/css/prism-dark.css"><link rel="stylesheet" href="/css/prism-line-numbers.css"><link rel="stylesheet" href="/public/css/user.css"><link rel="stylesheet" href="/css/katex.min.css"><link rel="icon" type="image/png" href="/public/images/favicon.ico"><style>a:not(.icon){text-decoration-color:#0fa0ce;background-image:linear-gradient(to bottom,rgba(0,0,0,0) 50%,#0fa0ce 50%)}blockquote{border-left:8px solid #0fa0ce}.nanobar .bar{background:#0fa0ce}.button.button-primary:focus,.button.button-primary:hover,button.button-primary:focus,button.button-primary:hover,input[type=button].button-primary:focus,input[type=button].button-primary:hover,input[type=reset].button-primary:focus,input[type=reset].button-primary:hover,input[type=submit].button-primary:focus,input[type=submit].button-primary:hover{background-color:#0fa0ce;border-color:#0fa0ce}input[type=email]:focus,input[type=number]:focus,input[type=password]:focus,input[type=search]:focus,input[type=tel]:focus,input[type=text]:focus,input[type=url]:focus,select:focus,textarea:focus{border:1px solid #0fa0ce}</style><script src="/js/pic.min.js" defer></script><script src="/js/search.min.js" defer></script><script src="/js/katex.min.js" defer></script><script src="/js/auto-render.min.js" defer></script><script>document.addEventListener("DOMContentLoaded",(function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!1},{left:"\\[",right:"\\]",display:!0}],throwOnError:!1})}))</script><meta name="generator" content="Hexo 6.3.0"></head><body><div class="container"><div class="row"><div><div class="row"><div class="two columns" style="max-width:50px"><h1 class="mt-2 mode"><div onclick="setDarkMode(!0)" id="darkBtn">üåë</div><div onclick="setDarkMode(!1)" id="lightBtn" class="hidden">‚òÄÔ∏è</div><script>function setDarkMode(e){var t=document.getElementById("darkBtn"),l=document.getElementById("lightBtn");e?(l.style.display="block",t.style.display="none",localStorage.setItem("preferredTheme","dark")):(l.style.display="none",t.style.display="block",localStorage.removeItem("preferredTheme")),document.body.classList.toggle("darkmode")}"dark"==localStorage.getItem("preferredTheme")&&setDarkMode(!0)</script></h1></div><div class="six columns ml-1"><h1 class="mt-2">Hi Folks.</h1></div><div class="twelve columns"><div class="row"><div class="nine columns left"><a href="/">Home</a> <a href="/archives" class="ml">Archives</a> <a href="/About" class="ml">About</a> <a href="mailto:jinzhongjia@qq.com" target="_blank" class="ml">Email</a></div></div><hr style="margin-bottom:2.6rem"></div></div><div class="trans"><h2>Implement KMP algorithm in zig</h2><h2 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h2><p><code>KMP</code> called <strong>Knuth‚ÄìMorris‚ÄìPratt string-searching algorithm</strong>, which is the first linear-time algorithm for string matching.</p><p>According to wikipedia:</p><blockquote><p>The algorithm was conceived by James H. Morris and independently discovered by Donald Knuth ‚Äúa few weeks later‚Äù from automata theory. Morris and Vaughan Pratt published a technical report in 1970. The three also published the algorithm jointly in 1977. Independently, in 1969, Matiyasevich discovered a similar algorithm, coded by a two-dimensional Turing machine, while studying a string-pattern-matching recognition problem over a binary alphabet.</p></blockquote><h2 id="Principle"><a href="#Principle" class="headerlink" title="Principle"></a>Principle</h2><p>The algorithm does not match one by one like other algorithms, it will store some history-matching in a array(we usually call it <code>next</code>) to reduce number of traversals.</p><p>For example, if we give a string to be matched <code>ABAABABCAA</code>, and the character string is <code>ABABC</code>, then how can we get the first matched position ?</p><p>Of course, you can give me the answer <code>3</code>(matched positions start at zero) at once, this is your brain tell you.</p><p>Then how can we make computer to do it ?</p><p>Let‚Äôs take a closer look at the strings, when we match part of string, such as <code>ABA</code>, then next character is <strong>A</strong> in<code>ABAABABCAA</code>. we won‚Äôt match successfully, then what will do to reduce comparison times.</p><p>Notice <code>ABA</code>, the longest identical string contained in the prefix string and the suffix string is <code>A</code>, that means what ?</p><p>Simply put, when we match failed, we don‚Äôt need to match string from first, we can just mathed from the second character <code>B</code>, because the suffix string and prefix string have indetical string <code>A</code>, that mean we can just skip one character to continue compare,.</p><p>And in comparison, the pointer of <code>ABAABABCAA</code> (string to compare) will not go back, so we can just get result in one pass.</p><p>Now, we need to build a array called <code>next</code> to store the the length of the string that can skip the comparison when there is a match error.</p><p>In our brain, the logic is just get the longest indentical string contained in prefix string and suffix string, but in computer we need to chang our brain.</p><p>we can just get a pointer which point current position of string<code>ABABC</code>, and another digital variable represents the longest length of the prefix and suffix. For first character <code>A</code>, we need to store 0 in <code>next</code> array, then <code>AB</code>, not exist indentical string in prefix and suffix, so store 0, when <code>ABA</code>, first charactre <code>A</code> and third character <code>A</code> is indentical, so we can store 1 in third element.</p><h2 id="Implement"><a href="#Implement" class="headerlink" title="Implement"></a>Implement</h2><p>Get <code>next</code> array:</p><pre class="line-numbers language-zig" data-language="zig"><code class="language-zig"><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">get_next</span><span class="token punctuation">(</span><span class="token keyword">comptime</span> patt<span class="token punctuation">:</span> <span class="token class-name"><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">const</span> <span class="token builtin-type keyword">u8</span></span><span class="token punctuation">)</span> <span class="token class-name"><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin-type keyword">u16</span></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> next <span class="token operator">=</span> <span class="token class-name"><span class="token punctuation">[</span>_<span class="token punctuation">]</span><span class="token builtin-type keyword">u16</span></span><span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">&#125;</span> <span class="token operator">**</span> patt<span class="token punctuation">.</span>len<span class="token punctuation">;</span>

    <span class="token keyword">var</span> prefix_len<span class="token punctuation">:</span> <span class="token class-name"><span class="token builtin-type keyword">u16</span></span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> i<span class="token punctuation">:</span> <span class="token class-name"><span class="token builtin-type keyword">u16</span></span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> patt<span class="token punctuation">.</span>len<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>patt<span class="token punctuation">[</span>prefix_len<span class="token punctuation">]</span> <span class="token operator">==</span> patt<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            prefix_len <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            next<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> prefix_len<span class="token punctuation">;</span>
            i <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>prefix_len <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                next<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                i <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                prefix_len <span class="token operator">=</span> next<span class="token punctuation">[</span>prefix_len <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> <span class="token operator">&amp;</span>next<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>For <code>KMP</code> matchind:</p><pre class="line-numbers language-zig" data-language="zig"><code class="language-zig"><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">kmp</span><span class="token punctuation">(</span>str<span class="token punctuation">:</span> <span class="token class-name"><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">const</span> <span class="token builtin-type keyword">u8</span></span><span class="token punctuation">,</span> <span class="token keyword">comptime</span> ch<span class="token punctuation">:</span> <span class="token class-name"><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">const</span> <span class="token builtin-type keyword">u8</span></span><span class="token punctuation">)</span> <span class="token class-name"><span class="token builtin-type keyword">u16</span></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> next <span class="token operator">=</span> <span class="token keyword">comptime</span> <span class="token function">get_next</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> i<span class="token punctuation">:</span> <span class="token class-name"><span class="token builtin-type keyword">u16</span></span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> j<span class="token punctuation">:</span> <span class="token class-name"><span class="token builtin-type keyword">u16</span></span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> str<span class="token punctuation">.</span>len <span class="token keyword">and</span> j <span class="token operator">&lt;</span> ch<span class="token punctuation">.</span>len<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>str<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> ch<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
            j <span class="token operator">=</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            j <span class="token operator">=</span> next<span class="token punctuation">[</span>j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            i <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">==</span> ch<span class="token punctuation">.</span>len<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token builtin">@intCast</span><span class="token punctuation">(</span><span class="token builtin-type keyword">u16</span><span class="token punctuation">,</span> i <span class="token operator">-</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Notice"><a href="#Notice" class="headerlink" title="Notice"></a>Notice</h2><p>You will notice I use <code>comptime</code> to call function, why?</p><p>Because we return <strong>a pointer to variable inside the block</strong>, if we don‚Äôt use <code>comptime</code>, it will be marked as recyclable when func <code>get_next</code> ends.</p><p>For better, you can use allocator to allocate memory for non-comptime, but you should need to free it when you no longer use it.</p><p><a class="classtest-link" href="/tags/algorithm/" rel="tag">algorithm</a>, <a class="classtest-link" href="/tags/zig/" rel="tag">zig</a> ‚Äî Mar 11, 2023</p></div><div class="row mt-2"><h3>Search</h3><div><input id="search-text" title="search" class="search-text" type="text" placeholder="search......"></div><div style="margin-top:1.5rem"><ul id="result"></ul></div></div><div class="row mt-2"><div class="eight columns"><p id="madewith">Made with ‚ù§ and <a class="footer-link icon" href="https://hexo.io" target="_blank" style="text-decoration:none" rel="noreferrer" aria-label="Hexo.io"><svg class="hexo svg-hov" width="14" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>Hexo.js</title><path d="M12 .007L1.57 6.056V18.05L12 23.995l10.43-6.049V5.952L12 .007zm4.798 17.105l-.939.521-.939-.521V12.94H9.08v4.172l-.94.521-.938-.521V6.89l.939-.521.939.521v4.172h5.84V6.89l.94-.521.938.521v10.222z"/></svg> </a>at <a href="https://en.wikipedia.org/wiki/China" target="_blank" rel="noreferrer">China</a>.</p></div><div class="four columns mb-3 posisi"><a class="ml-0 footer-link icon" href="https://github.com/jinzhongjia" target="_blank" style="text-decoration:none" rel="noreferrer" aria-label="GitHub"><svg class="github svg-hov" width="18" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a></div></div></div></div></div><script src="/js/nanobar.min.js"></script><script>var options={classname:"nanobar",id:"myNanobar"},nanobar=new Nanobar(options);nanobar.go(30),nanobar.go(76),nanobar.go(100)</script></body></html>